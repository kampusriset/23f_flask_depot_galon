<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Arta Tirta</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="header">
    <h1>Arta Tirta â€” Air Minum Isi Ulang</h1>
    <p>Manajemen Operasional Depot Air Minum</p>
</div>

<nav class="navbar">
    <ul>
        <li><a href="/dashboard" class="active">Dashboard</a></li>
        <li><a href="/pemesanan">Pemesanan</a></li>
        <li><a href="/harga">Daftar Harga & Pesan</a></li>
    </ul>
    <div class="user-info">
        <span style="color: #0077c8; font-weight: bold;">
            {{ username }}
        </span>
        {% if session.get('role') == 'admin' %}
        <span class="role-badge">Admin</span>
        {% endif %}
        <a href="/logout" class="logout">Logout</a>
    </div>
</nav>

<div class="container">
    
    <div class="welcome-box">
        <h2>Selamat Datang, {{ username }}!</h2>
        <p>Sistem Manajemen Depot Air Minum Isi Ulang</p>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="cards">
        <div class="card">
            <h3>Total Pesanan</h3>
            <p style="font-size: 36px; color: #0077c8; font-weight: bold;">{{ total_pesanan }}</p>
            <p>Total pesanan yang pernah dibuat</p>
        </div>
        
        <div class="card">
            <h3>Menunggu Konfirmasi</h3>
            <p style="font-size: 36px; color: #ff9900; font-weight: bold;">{{ pesanan_menunggu }}</p>
            <p>Pesanan yang sedang diproses</p>
        </div>
        
        <div class="card">
            <h3>Pesanan Selesai</h3>
            <p style="font-size: 36px; color: #28a745; font-weight: bold;">{{ pesanan_selesai }}</p>
            <p>Pesanan yang telah selesai</p>
        </div>
    </div>

    {% if session.get('role') == 'admin' %}
    <div style="text-align: center; margin-top: 30px;">
        <a href="/admin/dashboard" class="btn" style="background: #6f42c1;">
            Dashboard Admin
        </a>
    </div>
    {% endif %}

    <div class="table-container" style="margin-top: 40px;">
        <h3>Pesanan Terbaru</h3>
        {% if pesanan_terbaru %}
        <table>
            <thead>
                <tr>
                    <th>Kode</th>
                    <th>Tanggal</th>
                    <th>Jenis Galon</th>
                    <th>Jumlah</th>
                    <th>Total</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for p in pesanan_terbaru %}
                <tr>
                    <td>{{ p.kode_pemesanan }}</td>
                    <td>{{ p.tanggal_pesan.strftime('%d-%m-%Y') }}</td>
                    <td>{{ p.jenis_galon }}</td>
                    <td>{{ p.jumlah }}</td>
                    <td>Rp {{ "{:,.0f}".format(p.total_harga) }}</td>
                    <td>
                        <span class="status-badge status-{{ p.status|lower|replace(' ', '-') }}">
                            {{ p.status }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="text-align: center; color: #666; padding: 20px;">
            Belum ada pesanan. <a href="/harga" class="link">Pesan sekarang!</a>
        </p>
        {% endif %}
    </div>

</div>

</body>
</html>